SELECT * FROM [dbo].[Nashville_housing]

select * 
from dbo.Nashville_housing
where PropertyAddress is NULL
ORDER BY ParcelID


select a.ParcelID, a.PropertyAddress, b.ParcelID, b. PropertyAddress, ISNULL(a.PropertyAddress,b.PropertyAddress)
from dbo.Nashville_housing a
JOIN dbo.Nashville_housing b
  on a.ParcelID = b.ParcelID
  AND a.UniqueID <> b.UniqueID
WHERE a.PropertyAddress is null

UPDATE a
SET PROPERTYADDRESS = ISNULL(a.PropertyAddress,b.PropertyAddress)
from dbo.Nashville_housing a
JOIN dbo.Nashville_housing b
  on a.ParcelID = b.ParcelID
  AND a.UniqueID <> b.UniqueID
WHERE a.PropertyAddress is null

------BREAKING ADDRESS INTO INDIVIDUAL COLUMNS (ADDRESS, CITY, STATE)

select
SUBSTRING(PROPERTYADDRESS, 1, CHARINDEX(',', PROPERTYADDRESS) -1) AS ADDRESS
from dbo.Nashville_housing

select
SUBSTRING(PROPERTYADDRESS, 1, CHARINDEX(',', PROPERTYADDRESS) -1) AS ADDRESS
, SUBSTRING(PROPERTYADDRESS, CHARINDEX(',', PROPERTYADDRESS)  + 1 , LEN(PROPERTYADDRESS)) AS CITY
from dbo.Nashville_housing

ALTER TABLE NASHVILLE_HOUSING
ADD ADDRESS NVARCHAR(255)

UPDATE NASHVILLE_HOUSING
SET ADDRESS = SUBSTRING(PROPERTYADDRESS, 1, CHARINDEX(',', PROPERTYADDRESS) -1)


ALTER TABLE NASHVILLE_HOUSING
ADD CITY NVARCHAR(255)

UPDATE NASHVILLE_HOUSING
SET CITY = SUBSTRING(PROPERTYADDRESS, CHARINDEX(',', PROPERTYADDRESS)  + 1 , LEN(PROPERTYADDRESS))


SELECT OwnerAddress
FROM dbo.Nashville_housing

SELECT
PARSENAME(REPLACE(OWNERADDRESS, ',','.') , 3)
, PARSENAME(REPLACE(OWNERADDRESS, ',','.') , 2)
, PARSENAME(REPLACE(OWNERADDRESS, ',','.') , 1)
FROM dbo.Nashville_housing

ALTER TABLE NASHVILLE_HOUSING
ADD OWNER_ADDRESS NVARCHAR(255)

UPDATE NASHVILLE_HOUSING
SET OWNER_ADDRESS = PARSENAME(REPLACE(OWNERADDRESS, ',','.') , 3)


ALTER TABLE NASHVILLE_HOUSING
ADD OWNER_CITY NVARCHAR(255)

UPDATE NASHVILLE_HOUSING
SET OWNER_CITY = PARSENAME(REPLACE(OWNERADDRESS, ',','.') , 2)

ALTER TABLE NASHVILLE_HOUSING
ADD OWNER_STATE NVARCHAR(255)

UPDATE NASHVILLE_HOUSING
SET OWNER_STATE = PARSENAME(REPLACE(OWNERADDRESS, ',','.') , 1)


SELECT * 
FROM [dbo].[Nashville_housing]

----REMOVE DUPLICATE
WITH RowNumCTE AS(
SELECT * ,
    ROW_NUMBER() OVER (
	PARTITION BY PARCELID,
	             PROPERTYADDRESS,
				 SalePrice,
				 SALEDATE,
				 LEGALREFERENCE
				 ORDER BY 
				    UniqueID
					) ROW_NUM
FROM [dbo].[Nashville_housing]
--ORDER BY ParcelID
)
SELECT *
FROM RowNumCTE

WITH RowNumCTE AS(
SELECT * ,
    ROW_NUMBER() OVER (
	PARTITION BY PARCELID,
	             PROPERTYADDRESS,
				 SalePrice,
				 SALEDATE,
				 LEGALREFERENCE
				 ORDER BY 
				    UniqueID
					) ROW_NUM
FROM [dbo].[Nashville_housing]
--ORDER BY ParcelID
)
DELETE
FROM RowNumCTE
WHERE row_num > 1

---DELETE  UNUSED COLUMNS---

ALTER TABLE [dbo].[Nashville_housing]
DROP COLUMN OWNERADDRESS, TAXDISTRICT, PROPERTYADDRESS


SELECT * FROM [dbo].[Nashville_housing]
